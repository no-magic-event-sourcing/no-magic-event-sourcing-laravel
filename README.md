# no-magic-event-sourcing-laravel
A simple, yet powerful and complete event sourcing framework for Laravel

Event sourcing is to state of your application what version control (e.g. Git) to your code. It would be horrifying if you code without version control, because you would not know what takes you to the current code snapshot. Is it not horrifying that you do not know how your system comes to the current state?

> The core idea of "Event Sourcing" is that whenever we make a change to the state of a system, we record that state change as an event, and we can confidently rebuild the system by reprocessing the events at any time in the future. <br>
> -- Martin Flower

There is a popular (according to Google search) Event sourcing framework on Laravel, called [laravel-event-sourcing](https://github.com/spatie/laravel-event-sourcing). I found it very hard to understand. It is ironic if you think Even sourcing is to simply reasoning of application state.

With saying that, some ideas are borrowed from that project:
1. aggregate_uuid in stored event;
1. event_class in stored event.

# Stored Event
StoredEvent is the only persistent model (version 0.0.1). It has the following attributes:

| attribute         | description                             |
|-------------------|-----------------------------------------|
| aggregate_uuid    | the uuid of target aggregate            |
| event_class       | the fully qualified class name of event |
| event_payload     | the payload of event as JSON            |
| event_actor       | the actor's id of event                 |
| created_at        | the time when the event is created      |

Let's go through the important attributes and discuss how the design decisions have been made.

At a high-level, the StoredEvent contains data about 
**who** did **what** to **which aggregate** at **what time**.

## Why storing aggregate_uuid as a separate attribute in Event?
There are a few design options on where to store the uuid of aggregate. 

### ❌ 1. Not to store the uuid in the event. 
For example, for the `CreateAccountEvent`, it is more natual NOT to store uuid in event.
This is because the uuid of aggregate is generated by the system, and it is not a part of the event.

However, if we don't store it with the event, when we replay the event, 
we will not know the uuid of aggregate.

### ❌ 2. Store the uuid in event_payload
Other natual place to store uuid is in event_payload. However, it makes it difficult to index and filter
events by target aggregate. That is the most common query on the event table.


The first version of this framework is an implementation of [Memory Image](http://martinfowler.com/bliki/MemoryImage.html) pattern. This means the current state of the application is _not stored in a database_.

This framework is not production ready, even though I use it in my product. My product is fairly simple, so be aware of the risk.